- name: Create OpenStack Servers
  hosts: localhost
  vars:
    OSP_GUID: "{{ lookup('env','OSP_GUID') }}"
    OSP_DOMAIN: "{{ lookup('env','OSP_DOMAIN') }}"
  tasks:
  - name: Create workstation inventory
    add_host:
       name: "workstation-{{ OSP_GUID }}.{{ OSP_DOMAIN }}"
       group: workstation
       ansible_user: cloud-user
       ansible_ssh_private_key_file: "/root/.ssh/openstack.pem"

- name: Deploy the 3 tier application
  hosts: workstation
  gather_facts: false
  roles:
  - name: osp-facts

# # Setup database tier
# - name: setup database tier
#   become: yes
#   hosts: appdbs
#   roles:
#     - {name: base-config, tags: base-config}
#     #- {name: db-tier, tags: [dbs, postgres]}

# # Setup application servers tier
# - name: setup app tier
#   hosts: apps
#   become: yes
#   gather_facts: false
#   roles:
#     - {name: base-config, tags: base-config}
#     #- {name: app-tier, tags: [apps, tomcat]}

# # Setup front-end load balancer tier
# - name: setup load-balancer tier
#   hosts: frontends
#   become: yes
#   roles:
#     - {name: base-config, tags: base-config}
#     #- {name: lb-tier, tags: [lbs, haproxy]}
